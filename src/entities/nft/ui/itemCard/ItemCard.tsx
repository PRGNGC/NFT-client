"use client";
import { useEffect, useState } from "react";
import styles from "./ItemCard.module.scss";
import Image from "next/image";
import type { INft, IPlanetNft, IItemNft, IBundleNft } from "../../api/types";
import { getEthPrice } from "@/shared/api/getEthPrice";
import { archivo } from "@/app/fonts";
import Link from "next/link";
import { usePathname } from "next/navigation";

interface ItemCardProps {
	item: INft;
	category: string;
}

export function ItemCard({ item, category }: ItemCardProps) {
	const [data, setData] = useState<{ USD: number } | null>(null);
	const [loading, setLoading] = useState<boolean>(true);
	const path = usePathname();

	useEffect(() => {
		getEthPrice().then((data) => {
			setData(data);
			setLoading(false);
		});
	}, []);

	const linkToGo = ["characters", "planets", "items", "bundles"].includes(
		path?.split("/")[path?.split("/").length - 1] as string
	)
		? `${path}/${item.id}`
		: path
				?.split("/")
				.toSpliced(path?.split("/").length - 1, 1)
				.concat(item.id)
				.join("/");

	return (
		<Link
			key={item.id}
			href={linkToGo as string}
		>
			<div className={styles.itemCardBlock}>
				<div className={styles.itemCardImgBlock}>
					<div className={styles.itemTraits}>
						{item.nftTraits &&
							item?.nftTraits.map((nftTrait: string) => {
								return <div className={styles.itemTrait}>{nftTrait}</div>;
							})}
					</div>
					<Image
						src={item.nftImg}
						alt="nft"
						width={308}
						height={308}
					/>
				</div>
				<div className={styles.commonInfo}>
					<div className={styles.nftIdEthPrice}>
						<span className={styles.nftId}>#{item.nftId}</span>
						<span className={styles.nftEthPrice}>{item.nftEthPrice} ETH</span>
					</div>
					<div className={styles.nftNameDollarPrice}>
						<p className={`${styles.nftName} ${archivo.className}`}>
							{item.nftName} {item.nftId}
						</p>
						<span className={styles.nftDollarPrice}>
							{loading && <p>Loading...</p>}
							{data?.USD !== undefined
								? `$${(data.USD * item.nftEthPrice).toFixed(2)}`
								: null}
						</span>
					</div>
					{category === "planets" && (
						<>
							<hr />
							<div className={styles.nftCoordinates}>
								<svg
									width="14"
									height="18"
									viewBox="0 0 14 18"
									fill="none"
									xmlns="http://www.w3.org/2000/svg"
								>
									<path
										fillRule="evenodd"
										clipRule="evenodd"
										d="M13.696 7.36364C13.696 8.94705 13.1464 10.4021 12.2274 11.5484H12.2313C12.2313 11.5484 9.90428 14.6624 8.10161 16.8674C7.52644 17.5708 6.47445 17.5706 5.8997 16.8668C4.1027 14.6667 1.77865 11.5551 1.77865 11.5551L1.77324 11.5484C0.854329 10.4021 0.304688 8.94705 0.304688 7.36364C0.304688 3.66572 3.30243 0.667969 7.00036 0.667969C10.6983 0.667969 13.696 3.66572 13.696 7.36364ZM9.50045 7.33464C9.50045 8.71539 8.3812 9.83464 7.00045 9.83464C5.6197 9.83464 4.50045 8.71539 4.50045 7.33464C4.50045 5.95393 5.6197 4.83464 7.00045 4.83464C8.3812 4.83464 9.50045 5.95393 9.50045 7.33464Z"
										fill="#30B38C"
									/>
								</svg>
								<p>{(item as IPlanetNft).nftCoordinates}</p>
							</div>
						</>
					)}
					{category === "items" && (
						<>
							<hr />
							<div className={styles.nftLevelRequirements}>
								<svg
									width="16"
									height="16"
									viewBox="0 0 16 16"
									fill="none"
									xmlns="http://www.w3.org/2000/svg"
								>
									<g clipPath="url(#clip0_5507_9736)">
										<path
											d="M4 0.666667V7.33333H12V0.666667C12 0.489856 11.9298 0.320286 11.8047 0.195262C11.6797 0.0702379 11.5101 0 11.3333 0L4.66667 0C4.48986 0 4.32029 0.0702379 4.19526 0.195262C4.07024 0.320286 4 0.489856 4 0.666667ZM8.77933 5.33333H7.86667V3.568C7.86667 3.35333 7.87133 3.15733 7.88067 2.98C7.81608 3.05645 7.74588 3.12798 7.67067 3.194L7.29267 3.506L6.826 2.932L7.968 2H8.77933V5.33333Z"
											fill="#7F8596"
										/>
										<path
											d="M0 9.33464V15.3346C0 15.5114 0.0702379 15.681 0.195262 15.806C0.320286 15.9311 0.489856 16.0013 0.666667 16.0013H7.33333V8.66797H0.666667C0.489856 8.66797 0.320286 8.73821 0.195262 8.86323C0.0702379 8.98826 0 9.15782 0 9.33464H0ZM4.856 14.0013H2.43867V13.4086L3.252 12.586C3.48489 12.3433 3.63689 12.1775 3.708 12.0886C3.76675 12.0186 3.81668 11.9415 3.85667 11.8593C3.88495 11.7964 3.8995 11.7282 3.89933 11.6593C3.90125 11.621 3.89466 11.5828 3.88001 11.5474C3.86537 11.5121 3.84305 11.4804 3.81467 11.4546C3.74794 11.4009 3.66353 11.374 3.578 11.3793C3.46599 11.3812 3.3564 11.4122 3.26 11.4693C3.13031 11.5459 3.0086 11.6352 2.89667 11.736L2.4 11.1553C2.53262 11.0311 2.6776 10.9207 2.83267 10.826C2.95271 10.7588 3.08118 10.7079 3.21467 10.6746C3.36744 10.6378 3.5242 10.6201 3.68133 10.622C3.87968 10.6186 4.07647 10.6575 4.25867 10.736C4.41859 10.8042 4.55557 10.9169 4.65333 11.0606C4.74599 11.2007 4.79452 11.3654 4.79267 11.5333C4.79709 11.778 4.72737 12.0183 4.59267 12.2226C4.51281 12.344 4.42151 12.4574 4.32 12.5613C4.20711 12.68 3.966 12.9049 3.59667 13.236V13.2586H4.85667L4.856 14.0013Z"
											fill="#7F8596"
										/>
										<path
											d="M8.66797 8.66797V16.0013H15.3346C15.5114 16.0013 15.681 15.9311 15.806 15.806C15.9311 15.681 16.0013 15.5114 16.0013 15.3346V9.33464C16.0013 9.15782 15.9311 8.98826 15.806 8.86323C15.681 8.73821 15.5114 8.66797 15.3346 8.66797H8.66797ZM13.1426 13.78C12.8386 13.9743 12.4809 14.0676 12.1206 14.0466C11.9538 14.0477 11.7873 14.0348 11.6226 14.008C11.453 13.9777 11.2868 13.9304 11.1266 13.8666V13.1193C11.2678 13.1923 11.4174 13.2478 11.572 13.2846C11.709 13.3186 11.8495 13.3365 11.9906 13.338C12.1394 13.3484 12.2882 13.3199 12.4226 13.2553C12.4664 13.2279 12.502 13.1891 12.5255 13.1431C12.5489 13.0971 12.5595 13.0455 12.556 12.994C12.561 12.9172 12.5356 12.8415 12.4853 12.7833C12.4214 12.7254 12.3423 12.6868 12.2573 12.672C12.1225 12.6437 11.985 12.6309 11.8473 12.634H11.642V11.9573H11.852C12.3093 11.9573 12.538 11.8404 12.538 11.6066C12.5403 11.5678 12.5321 11.529 12.5141 11.4945C12.4962 11.46 12.4691 11.431 12.436 11.4106C12.3534 11.3632 12.2591 11.34 12.164 11.344C11.9279 11.3513 11.6988 11.4255 11.5033 11.558L11.1293 10.958C11.2942 10.842 11.4771 10.7542 11.6706 10.698C11.8777 10.6437 12.0912 10.6177 12.3053 10.6206C12.5904 10.6048 12.8735 10.6764 13.1166 10.826C13.2098 10.8871 13.2858 10.9711 13.3372 11.07C13.3887 11.1688 13.414 11.2792 13.4106 11.3906C13.4146 11.5855 13.3473 11.7752 13.2213 11.924C13.0755 12.0837 12.885 12.1959 12.6746 12.246V12.26C13.2306 12.3302 13.5086 12.5929 13.5086 13.048C13.5139 13.1909 13.4831 13.3328 13.4191 13.4607C13.3552 13.5886 13.2601 13.6984 13.1426 13.78Z"
											fill="#7F8596"
										/>
									</g>
									<defs>
										<clipPath id="clip0_5507_9736">
											<rect
												width="16"
												height="16"
												fill="white"
											/>
										</clipPath>
									</defs>
								</svg>
								<p>
									Level requirements:
									<span>{(item as IItemNft).nftLevelRequirement}</span>
								</p>
							</div>
						</>
					)}
					{category === "bundles" && (
						<>
							<hr />
							<div className={styles.bundleFeatures}>
								<div className={styles.nftLevelRequirements}>
									<svg
										width="16"
										height="16"
										viewBox="0 0 16 16"
										fill="none"
										xmlns="http://www.w3.org/2000/svg"
									>
										<g clipPath="url(#clip0_5507_9736)">
											<path
												d="M4 0.666667V7.33333H12V0.666667C12 0.489856 11.9298 0.320286 11.8047 0.195262C11.6797 0.0702379 11.5101 0 11.3333 0L4.66667 0C4.48986 0 4.32029 0.0702379 4.19526 0.195262C4.07024 0.320286 4 0.489856 4 0.666667ZM8.77933 5.33333H7.86667V3.568C7.86667 3.35333 7.87133 3.15733 7.88067 2.98C7.81608 3.05645 7.74588 3.12798 7.67067 3.194L7.29267 3.506L6.826 2.932L7.968 2H8.77933V5.33333Z"
												fill="#7F8596"
											/>
											<path
												d="M0 9.33464V15.3346C0 15.5114 0.0702379 15.681 0.195262 15.806C0.320286 15.9311 0.489856 16.0013 0.666667 16.0013H7.33333V8.66797H0.666667C0.489856 8.66797 0.320286 8.73821 0.195262 8.86323C0.0702379 8.98826 0 9.15782 0 9.33464H0ZM4.856 14.0013H2.43867V13.4086L3.252 12.586C3.48489 12.3433 3.63689 12.1775 3.708 12.0886C3.76675 12.0186 3.81668 11.9415 3.85667 11.8593C3.88495 11.7964 3.8995 11.7282 3.89933 11.6593C3.90125 11.621 3.89466 11.5828 3.88001 11.5474C3.86537 11.5121 3.84305 11.4804 3.81467 11.4546C3.74794 11.4009 3.66353 11.374 3.578 11.3793C3.46599 11.3812 3.3564 11.4122 3.26 11.4693C3.13031 11.5459 3.0086 11.6352 2.89667 11.736L2.4 11.1553C2.53262 11.0311 2.6776 10.9207 2.83267 10.826C2.95271 10.7588 3.08118 10.7079 3.21467 10.6746C3.36744 10.6378 3.5242 10.6201 3.68133 10.622C3.87968 10.6186 4.07647 10.6575 4.25867 10.736C4.41859 10.8042 4.55557 10.9169 4.65333 11.0606C4.74599 11.2007 4.79452 11.3654 4.79267 11.5333C4.79709 11.778 4.72737 12.0183 4.59267 12.2226C4.51281 12.344 4.42151 12.4574 4.32 12.5613C4.20711 12.68 3.966 12.9049 3.59667 13.236V13.2586H4.85667L4.856 14.0013Z"
												fill="#7F8596"
											/>
											<path
												d="M8.66797 8.66797V16.0013H15.3346C15.5114 16.0013 15.681 15.9311 15.806 15.806C15.9311 15.681 16.0013 15.5114 16.0013 15.3346V9.33464C16.0013 9.15782 15.9311 8.98826 15.806 8.86323C15.681 8.73821 15.5114 8.66797 15.3346 8.66797H8.66797ZM13.1426 13.78C12.8386 13.9743 12.4809 14.0676 12.1206 14.0466C11.9538 14.0477 11.7873 14.0348 11.6226 14.008C11.453 13.9777 11.2868 13.9304 11.1266 13.8666V13.1193C11.2678 13.1923 11.4174 13.2478 11.572 13.2846C11.709 13.3186 11.8495 13.3365 11.9906 13.338C12.1394 13.3484 12.2882 13.3199 12.4226 13.2553C12.4664 13.2279 12.502 13.1891 12.5255 13.1431C12.5489 13.0971 12.5595 13.0455 12.556 12.994C12.561 12.9172 12.5356 12.8415 12.4853 12.7833C12.4214 12.7254 12.3423 12.6868 12.2573 12.672C12.1225 12.6437 11.985 12.6309 11.8473 12.634H11.642V11.9573H11.852C12.3093 11.9573 12.538 11.8404 12.538 11.6066C12.5403 11.5678 12.5321 11.529 12.5141 11.4945C12.4962 11.46 12.4691 11.431 12.436 11.4106C12.3534 11.3632 12.2591 11.34 12.164 11.344C11.9279 11.3513 11.6988 11.4255 11.5033 11.558L11.1293 10.958C11.2942 10.842 11.4771 10.7542 11.6706 10.698C11.8777 10.6437 12.0912 10.6177 12.3053 10.6206C12.5904 10.6048 12.8735 10.6764 13.1166 10.826C13.2098 10.8871 13.2858 10.9711 13.3372 11.07C13.3887 11.1688 13.414 11.2792 13.4106 11.3906C13.4146 11.5855 13.3473 11.7752 13.2213 11.924C13.0755 12.0837 12.885 12.1959 12.6746 12.246V12.26C13.2306 12.3302 13.5086 12.5929 13.5086 13.048C13.5139 13.1909 13.4831 13.3328 13.4191 13.4607C13.3552 13.5886 13.2601 13.6984 13.1426 13.78Z"
												fill="#7F8596"
											/>
										</g>
										<defs>
											<clipPath id="clip0_5507_9736">
												<rect
													width="16"
													height="16"
													fill="white"
												/>
											</clipPath>
										</defs>
									</svg>
									<p>
										Level requirements:{" "}
										<span>{(item as IBundleNft).nftLevelRequirement}</span>
									</p>
								</div>
								<div className={styles.usedFor}>
									{(item as IBundleNft).nftDetails.usedFor.map(
										(character: string) => {
											return (
												<Image
													src={character}
													width={24}
													height={24}
													alt="img"
												/>
											);
										}
									)}
								</div>
							</div>
						</>
					)}
				</div>
			</div>
		</Link>
	);
}
